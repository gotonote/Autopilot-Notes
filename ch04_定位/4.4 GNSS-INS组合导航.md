# 4.4 GNSS-INS组合导航

## 一、GNSS原理与误差分析

### 1. GNSS基本原理

全球导航卫星系统（Global Navigation Satellite System, GNSS）是通过接收卫星信号来确定接收机位置的技术。目前主要的GNSS系统包括：

| 系统 | 所属国家/地区 | 卫星数量 | 轨道类型 |
|------|--------------|----------|----------|
| **GPS** | 美国 | 31+ | MEO |
| **北斗（BDS）** | 中国 | 45+ | GEO/IGSO/MEO |
| **GLONASS** | 俄罗斯 | 24+ | MEO |
| **Galileo** | 欧盟 | 24+ | MEO |

<!-- 插入一行空格 -->
<div align=center>
<img src="../imgs/gnss_constellation.png" width="500" height="350">
</div>
<div align=center>图1. GNSS卫星星座示意图</div>
<!-- 插入一行空格 -->

#### 1.1 定位原理

GNSS定位基于**三边测量（Trilateration）**原理：

卫星广播其精确位置和信号发送时间，接收机测量信号到达时间（Time of Arrival, TOA），计算卫星到接收机的距离（伪距）。

**伪距方程**：

$$\rho^i = \sqrt{(x^i - x)^2 + (y^i - y)^2 + (z^i - z)^2} + c \cdot \delta t + \epsilon^i$$

其中：
- $\rho^i$：接收机到第$i$颗卫星的伪距测量
- $(x^i, y^i, z^i)$：第$i$颗卫星的位置
- $(x, y, z)$：接收机待求位置
- $c$：光速
- $\delta t$：接收机钟差（待求）
- $\epsilon^i$：测量误差

为了求解$(x, y, z)$和$\delta t$四个未知数，至少需要4颗卫星的观测。

#### 1.2 坐标系统

GNSS使用**WGS-84（World Geodetic System 1984）**坐标系：

- 地心地固坐标系（ECEF）
- 原点：地球质心
- Z轴：指向协议地球极（CTP）
- X轴：指向格林尼治子午线与CTP赤道的交点

位置表示：
- 地心地直角坐标：$(X, Y, Z)$
- 大地坐标：$(\phi, \lambda, h)$（纬度、经度、椭球高）

坐标转换：

$$\begin{bmatrix} X \\ Y \\ Z \end{bmatrix} = 
\begin{bmatrix} (N + h) \cos\phi \cos\lambda \\ (N + h) \cos\phi \sin\lambda \\ [N(1 - e^2) + h] \sin\phi \end{bmatrix}$$

其中$N = \frac{a}{\sqrt{1 - e^2 \sin^2\phi}}$为卯酉圈曲率半径，$a$为椭球长半轴，$e$为第一偏心率。

### 2. GNSS误差源分析

GNSS定位误差来源可分为三类：

#### 2.1 与卫星有关的误差

**（1）星历误差**
- 卫星轨道参数预报误差
- 典型值：$1-5m$

**（2）卫星钟差**
- 卫星原子钟与GNSS系统时的偏差
- 模型改正后残差：$1-2ns$（约$0.3-0.6m$）

**（3）相对论效应**
- 卫星钟与地表钟的相对论时间差异
- 可通过模型精确改正

#### 2.2 与信号传播有关的误差

**（1）电离层延迟**
- 电离层中自由电子对信号的折射
- 与频率相关：$I \propto \frac{1}{f^2}$
- 双频接收机可消除99%以上
- 单频典型值：$5-15m$（天顶方向）到$50m$（低仰角）

电离层延迟模型（Klobuchar模型）：

$$I_z = \begin{cases} F \cdot \left[ 5 \times 10^{-9} + \sum_{n=0}^{3} \alpha_n \phi_m^n \cdot (1 - \frac{x^2}{2} + \frac{x^4}{24}) \right], & |x| \lt 1.57 \\ F \cdot 5 \times 10^{-9}, & |x| \geq 1.57 \end{cases}$$

其中$F$为映射函数，$\phi_m$为地磁纬度，$\alpha_n$为广播星历参数。

**（2）对流层延迟**
- 中性大气对信号的折射
- 与频率无关（不能通过双频消除）
- 典型值：$2-25m$

对流层延迟可分为干分量和湿分量：

$$T = T_d + T_w = \frac{10^{-6} k_1 R_d P}{g_m} \cdot M_d + \frac{10^{-6} k_2 R_w e}{T} \cdot M_w$$

**（3）多路径效应**
- 信号经反射到达接收机
- 与接收机周围环境相关
- 典型值：$1-5m$，极端情况可达$10m+$

<!-- 插入一行空格 -->
<div align=center>
<img src="../imgs/multipath.png" width="450" height="280">
</div>
<div align=center>图2. 多路径效应示意图</div>
<!-- 插入一行空格 -->

#### 2.3 与接收机有关的误差

**（1）接收机钟差**
- 接收机石英钟与系统时的偏差
- 作为未知数估计

**（2）天线相位中心偏差**
- 天线电气中心与几何中心不一致
- 可通过模型或校准改正

**（3）接收机噪声**
- 热噪声、量化噪声等
- 典型值：$0.1-1m$

#### 2.4 误差总结

| 误差源 | 单频典型值 | 双频改正后 | 差分改正后 |
|--------|-----------|-----------|-----------|
| 星历误差 | $2-5m$ | $2-5m$ | $<0.1m$ |
| 卫星钟差 | $2m$ | $2m$ | $<0.1m$ |
| 电离层延迟 | $5-15m$ | $<0.5m$ | $<0.1m$ |
| 对流层延迟 | $0.5-5m$ | $0.5-5m$ | $<0.1m$ |
| 多路径 | $0.5-5m$ | $0.5-5m$ | $0.1-1m$ |
| 接收机噪声 | $0.1-1m$ | $0.1-1m$ | $0.01-0.1m$ |
| **总计** | **$10-30m$** | **$3-10m$** | **$0.01-1m$** |

### 3. 差分GNSS技术

#### 3.1 差分原理

利用基准站（Base Station）已知精确坐标，计算误差改正数，发送给流动站（Rover）改正。

基准站伪距误差：

$$\Delta \rho_B = \rho_B - \rho_B^{\text{true}}$$

流动站改正后伪距：

$$\rho_R^{\text{corrected}} = \rho_R - \Delta \rho_B$$

差分可消除：卫星钟差、星历误差、电离层（短基线）、对流层（短基线）误差。

#### 3.2 DGPS/RTK/PPP对比

| 技术 | 定位原理 | 精度 | 覆盖范围 | 初始化时间 |
|------|----------|------|----------|-----------|
| **DGPS** | 伪距差分 | $0.5-2m$ | 区域 | 即时 |
| **RTK** | 载波相位差分 | $1-2cm$ | 基站$30-50km$ | $1-60s$ |
| **PPP** | 精密单点定位 | $5-20cm$ | 全球 | $10-30min$ |
| **PPP-RTK** | 精密单点+状态域 | $1-5cm$ | 全球 | $1-5min$ |

## 二、惯性导航系统（INS）原理

### 1. INS基本原理

惯性导航系统（Inertial Navigation System, INS）通过测量载体的加速度和角速度，积分计算位置、速度和姿态。

#### 1.1 核心器件

**陀螺仪（Gyroscope）**：
- 测量角速度$\boldsymbol{\omega}_{ib}^b$（载体相对于惯性系的旋转）
- 类型：机械陀螺、光纤陀螺（FOG）、MEMS陀螺

**加速度计（Accelerometer）**：
- 测量比力$\mathbf{f}^b$（非引力外力产生的加速度）
- 类型：摆式、振梁式、MEMS

#### 1.2 导航方程

INS的核心是**惯性导航方程**，在导航坐标系（n系）下：

**姿态更新**：
$$\dot{\mathbf{C}}_b^n = \mathbf{C}_b^n \boldsymbol{\Omega}_{nb}^b$$

其中$\boldsymbol{\Omega}_{nb}^b$为角速度的反对称矩阵：

$$\boldsymbol{\Omega}_{nb}^b = \begin{bmatrix} 0 & -\omega_z & \omega_y \\ \omega_z & 0 & -\omega_x \\ -\omega_y & \omega_x & 0 \end{bmatrix}$$

**速度更新**：
$$\dot{\mathbf{v}}^n = \mathbf{C}_b^n \mathbf{f}^b - (2\boldsymbol{\omega}_{ie}^n + \boldsymbol{\omega}_{en}^n) \times \mathbf{v}^n + \mathbf{g}^n$$

其中：
- $\mathbf{C}_b^n \mathbf{f}^b$：比力转换到导航系
- $2\boldsymbol{\omega}_{ie}^n \times \mathbf{v}^n$：科里奥利加速度
- $\boldsymbol{\omega}_{en}^n \times \mathbf{v}^n$：地球自转引起的牵连加速度
- $\mathbf{g}^n$：重力矢量

**位置更新**：
$$\dot{\phi} = \frac{v_N}{R_M + h}, \quad \dot{\lambda} = \frac{v_E}{(R_N + h)\cos\phi}, \quad \dot{h} = -v_D$$

其中$R_M$和$R_N$分别为子午圈和卯酉圈曲率半径。

### 2. INS误差分析

#### 2.1 误差来源

**（1）器件误差**

陀螺仪误差：
- 零偏（Bias）：$b_g$
- 比例因子误差：$SF_g$
- 随机游走（ARW）：$N_g$

加速度计误差：
- 零偏（Bias）：$b_a$
- 比例因子误差：$SF_a$
- 随机游走（VRW）：$N_a$

**（2）初始对准误差**
- 初始姿态误差：$\delta \phi_0, \delta \theta_0, \delta \psi_0$
- 初始速度误差：$\delta v_0$
- 初始位置误差：$\delta p_0$

**（3）计算误差**
- 数值积分误差
- 圆锥误差、划船误差等

#### 2.2 误差传播特性

INS误差随时间累积，是**舒拉（Schuler）调谐周期**和**地球自转周期**的函数。

**简化误差模型**（静止状态）：

姿态误差：
$$\delta \theta(t) = \delta \theta_0 + b_g \cdot t$$

速度误差：
$$\delta v(t) = \delta v_0 + (b_a + g \cdot \delta \theta_0) \cdot t + \frac{1}{2} g \cdot b_g \cdot t^2$$

位置误差：
$$\delta p(t) = \delta p_0 + \delta v_0 \cdot t + \frac{1}{2}(b_a + g \cdot \delta \theta_0) \cdot t^2 + \frac{1}{6} g \cdot b_g \cdot t^3$$

**关键结论**：
- 加速度计零偏导致位置误差按$t^2$增长
- 陀螺仪零偏导致位置误差按$t^3$增长

<!-- 插入一行空格 -->
<div align=center>
<img src="../imgs/ins_drift.png" width="550" height="300">
</div>
<div align=center>图3. INS误差随时间累积示意图</div>
<!-- 插入一行空格 -->

#### 2.3 不同等级IMU性能

| IMU等级 | 陀螺零偏 | 加速度计零偏 | 1小时位置误差 |
|---------|----------|-------------|--------------|
| **消费级** | $10-100°/h$ | $10-100mg$ | $km$级 |
| **工业级** | $1-10°/h$ | $1-10mg$ | $100m$级 |
| **战术级** | $0.1-1°/h$ | $0.1-1mg$ | $10m$级 |
| **导航级** | $0.01°/h$ | $0.01mg$ | $1m$级 |
| **战略级** | $<0.001°/h$ | $<0.001mg$ | $<100m$（天） |

自动驾驶通常使用**战术级**或**工业级**MEMS IMU。

### 3. 捷联式惯性导航（Strapdown INS）

现代INS主要采用捷联式架构：

**特点**：
- 惯性器件直接固联在载体上
- 通过数学平台（姿态矩阵）实现坐标转换
- 无机械转动部件，可靠性高

**算法流程**：
1. 陀螺仪测量$\rightarrow$姿态更新（四元数/旋转矩阵）
2. 加速度计测量$\rightarrow$扣除重力$\rightarrow$积分得速度
3. 速度积分得位置

**姿态表示**：
- 四元数（常用）：避免万向节锁，计算效率高
- 旋转矩阵：直接用于坐标转换
- 欧拉角：直观但存在奇异性

四元数更新：
$$\mathbf{q}(t + \Delta t) = \mathbf{q}(t) \otimes \Delta \mathbf{q}$$

其中$\otimes$为四元数乘法，$\Delta \mathbf{q} \approx [1, \frac{\Delta \theta_x}{2}, \frac{\Delta \theta_y}{2}, \frac{\Delta \theta_z}{2}]^T$为小角度旋转四元数。

## 三、GNSS-INS组合导航

### 1. 组合优势

GNSS和INS具有天然的互补性：

| 特性 | GNSS | INS | 组合系统 |
|------|------|-----|----------|
| **绝对/相对** | 绝对定位 | 相对定位 | 绝对+相对 |
| **短期精度** | 噪声大 | 精度高 | 高精度 |
| **长期精度** | 无漂移 | 累积误差 | 无漂移 |
| **输出频率** | $1-20Hz$ | $50-1000Hz$ | $50-1000Hz$ |
| **信号依赖** | 需卫星信号 | 自主 | 自主+辅助 |
| **动态响应** | 有延迟 | 实时 | 实时 |

### 2. 组合模式

#### 2.1 松组合（Loose Coupling）

**结构**：GNSS和INS独立解算，GNSS位置/速度作为INS的观测值。

**观测方程**：
$$\mathbf{z}_{GNSS} = \begin{bmatrix} \mathbf{p}_{GNSS} \\ \mathbf{v}_{GNSS} \end{bmatrix} = \mathbf{H} \mathbf{x} + \mathbf{v}$$

其中状态$\mathbf{x} = [\delta \mathbf{p}, \delta \mathbf{v}, \delta \boldsymbol{\psi}, \mathbf{b}_g, \mathbf{b}_a]^T$。

**优点**：
- 结构简单，易于实现
- 模块化程度高

**缺点**：
- 需要至少4颗卫星
- 信息利用率低

#### 2.2 紧组合（Tight Coupling）

**结构**：直接使用GNSS原始观测（伪距、载波相位）与INS预测值比较。

**伪距观测方程**：
$$\delta \rho = \rho_{GNSS} - \rho_{INS} = \mathbf{G} \cdot \delta \mathbf{p} + c \cdot \delta t + \epsilon$$

其中$\mathbf{G}$为卫星到接收机的方向余弦矩阵。

**优点**：
- 可用卫星数少于4颗时仍能工作
- 信息利用率高，精度更好

**缺点**：
- 实现复杂
- 计算量大

#### 2.3 深组合（Deep Coupling）

**结构**：INS辅助GNSS跟踪环路，形成更深层次的融合。

**原理**：
- INS提供载体的动态预测
- 辅助GNSS接收机更窄的跟踪带宽
- 提高高动态或弱信号环境下的性能

**优点**：
- 抗干扰能力强
- 高动态性能好

**缺点**：
- 硬件耦合度高
- 系统复杂

### 3. 卡尔曼滤波融合

GNSS-INS组合通常使用扩展卡尔曼滤波（EKF）或无迹卡尔曼滤波（UKF）。

#### 3.1 状态向量

15维状态向量（误差状态）：

$$\mathbf{x} = [\delta \mathbf{p}^T, \delta \mathbf{v}^T, \delta \boldsymbol{\psi}^T, \mathbf{b}_g^T, \mathbf{b}_a^T]^T$$

其中：
- $\delta \mathbf{p} = [\delta \phi, \delta \lambda, \delta h]^T$：位置误差
- $\delta \mathbf{v} = [\delta v_N, \delta v_E, \delta v_D]^T$：速度误差
- $\delta \boldsymbol{\psi} = [\delta \phi, \delta \theta, \delta \psi]^T$：姿态误差角
- $\mathbf{b}_g = [b_{gx}, b_{gy}, b_{gz}]^T$：陀螺零偏
- $\mathbf{b}_a = [b_{ax}, b_{ay}, b_{az}]^T$：加速度计零偏

#### 3.2 状态转移矩阵

INS误差传播方程：

$$\dot{\delta \mathbf{p}} = -\boldsymbol{\omega}_{en} \times \delta \mathbf{p} + \delta \mathbf{v}$$
$$\dot{\delta \mathbf{v}} = \mathbf{f} \times \delta \boldsymbol{\psi} + \mathbf{C}_b^n \delta \mathbf{b}_a + \delta \mathbf{g}$$
$$\dot{\delta \boldsymbol{\psi}} = -\boldsymbol{\omega}_{in} \times \delta \boldsymbol{\psi} + \mathbf{C}_b^n \delta \mathbf{b}_g$$
$$\dot{\mathbf{b}}_g = \mathbf{w}_{bg}, \quad \dot{\mathbf{b}}_a = \mathbf{w}_{ba}$$

离散化后的状态转移矩阵$\mathbf{F}$为$15 \times 15$矩阵。

#### 3.3 GNSS观测更新

**松组合观测矩阵**：
$$\mathbf{H}_{\text{loose}} = \begin{bmatrix} \mathbf{I}_3 & \mathbf{0} & \mathbf{0} & \mathbf{0} & \mathbf{0} \\ \mathbf{0} & \mathbf{I}_3 & \mathbf{0} & \mathbf{0} & \mathbf{0} \end{bmatrix}$$

**紧组合观测矩阵**：
$$\mathbf{H}_{\text{tight}} = \begin{bmatrix} \mathbf{G} & \mathbf{0} & \mathbf{0} & \mathbf{0} & \mathbf{0} & \mathbf{1}_{N \times 1} \end{bmatrix}$$

其中$\mathbf{G}$包含各卫星的方向余弦，最后一列对应接收机钟差。

### 4. RTK与PPP技术

#### 4.1 RTK（Real-Time Kinematic）

**原理**：
利用基准站和流动站的载波相位观测值差分，实现厘米级定位。

**载波相位观测方程**：
$$\Phi = \rho + c(\delta t_r - \delta t^s) + T - I + \lambda N + \epsilon$$

其中$\Phi$为载波相位测量（距离单位），$\lambda$为波长，$N$为整周模糊度。

**双差观测**：
$$\nabla \Delta \Phi = \nabla \Delta \rho + \lambda \nabla \Delta N + \nabla \Delta \epsilon$$

消除卫星钟差、接收机钟差、电离层、对流层（短基线）误差。

**关键：整周模糊度固定（AR）**

通过搜索或LAMBDA算法求解整数模糊度：
$$\mathbf{N} = \arg\min_{\mathbf{N} \in \mathbb{Z}^n} (\hat{\mathbf{N}} - \mathbf{N})^T \mathbf{Q}_{\hat{N}}^{-1} (\hat{\mathbf{N}} - \mathbf{N})$$

固定成功后，定位精度可达$1-2cm$。

#### 4.2 PPP（Precise Point Positioning）

**原理**：
使用精密星历和钟差产品，单站实现高精度定位。

**精密产品**：
- 精密星历（轨道精度$\sim 2.5cm$）
- 精密钟差（精度$\sim 75ps$）
- 通过IGS（International GNSS Service）网络提供

**特点**：
- 无需基准站，全球可用
- 收敛时间$10-30$分钟
- 精度$5-20cm$

**PPP-RTK**：
结合PPP和RTK优势，通过互联网播发状态域改正数，实现快速收敛（$1-5$分钟）和厘米级精度。

#### 4.3 RTK与PPP对比

| 特性 | RTK | PPP | PPP-RTK |
|------|-----|-----|---------|
| **覆盖** | 基站$50km$内 | 全球 | 全球 |
| **精度** | $1-2cm$ | $5-20cm$ | $1-5cm$ |
| **初始化** | $1-60s$ | $10-30min$ | $1-5min$ |
| **基础设施** | 需密集基准站 | 需精密产品 | 需增强网络 |
| **通信** | 需实时链路 | 可事后处理 | 需互联网 |

## 四、实际应用与性能评估

### 1. 自动驾驶中的GNSS-INS

#### 1.1 典型配置

**消费级方案**：
- GNSS：单频RTK接收机
- IMU：消费级MEMS（$10°/h$）
- 精度：$10-30cm$（GNSS有效时）

**专业级方案**：
- GNSS：多频多系统RTK
- IMU：战术级MEMS或光纤陀螺
- 精度：$2-10cm$，姿态$0.05-0.1°$

#### 1.2 应用场景

**（1）高精度定位**
车道级导航、自主泊车需要厘米级定位。

**（2）辅助感知**
- 提供地理参考框架
- 辅助地图匹配定位

**（3）时间同步**
GNSS提供精确的UTC时间，用于多传感器同步。

### 2. 性能评估

#### 2.1 精度评估

**静态精度测试**：
- 固定点长时间观测
- 统计RMS误差

**动态精度测试**：
- 与参考轨迹（如全站仪、更高精度系统）比较
- CEP、SEP统计

#### 2.2 可用性评估

- **定位可用率**：满足精度要求的时间比例
- **固定解比例**：RTK固定解的时间比例
- **重捕获时间**：信号遮挡后恢复时间

#### 2.3 完好性评估

- **保护等级（PL）**：基于协方差计算的位置不确定度边界
- **告警限值（AL）**：系统可接受的最大误差
- **完好性风险（IR）**：未检测到的危险误差概率

完好性判定：
$$\text{PL} \leq \text{AL} \quad \text{and} \quad |\mathbf{p}_{\text{est}} - \mathbf{p}_{\text{true}}| \leq \text{AL}$$

### 3. 挑战与发展

#### 3.1 当前挑战

**（1）城市环境**
- 多路径、遮挡导致GNSS性能下降
- 需要视觉/LiDAR辅助

**（2）完好性保障**
- 民用GNSS缺乏航空级的完好性监测
- 需要开发汽车级完好性算法

**（3）成本优化**
- 高精度IMU成本较高
- 需要低成本MEMS的优化算法

#### 3.2 发展趋势

**（1）多频多系统GNSS**
GPS+北斗+GLONASS+Galileo组合，提高可用性和精度。

**（2） PPP-RTK普及**
通过互联网播发改正数，降低对密集基准站的依赖。

**（3）与视觉/激光深度融合**
GNSS-INS作为基础层，与SLAM、地图匹配深度融合。

**（4）车载协同定位**
V2V/V2I辅助，提高整体定位性能。

## 五、小结

本章深入介绍了GNSS-INS组合导航技术：

1. **GNSS原理与误差**：三边测量原理，电离层、对流层、多路径等误差源
2. **INS原理与误差**：惯性器件测量，误差随$t^2$/$t^3$累积
3. **组合导航优势**：GNSS与INS互补，卡尔曼滤波融合
4. **RTK与PPP技术**：厘米级定位的实现方式

GNSS-INS组合导航是自动驾驶定位的基础支撑技术，为车辆提供全场景、全天候的位置和姿态信息。

---

## 参考文献

[1] Kaplan E D, Hegarty C J. Understanding GPS/GNSS: principles and applications[M]. Artech house, 2017.

[2] Groves P D. Principles of GNSS, inertial, and multisensor integrated navigation systems[M]. Artech house, 2013.

[3] Farrell J A. Aided navigation: GPS with high rate sensors[M]. McGraw-Hill, Inc., 2008.

[4] Teunissen P J, Montenbruck O. Springer handbook of global navigation satellite systems[M]. Springer, 2017.

[5] Zumberge J F, Heflin M B, Jefferson D C, et al. Precise point positioning for the efficient and robust analysis of GPS data from large networks[J]. Journal of Geophysical Research: Solid Earth, 1997, 102(B3): 5005-5017.

[6] Takasu T, Yasuda A. Development of the low-cost RTK-GPS receiver with an open source program package RTKLIB[C]//International symposium on GPS/GNSS. 2009, 1(1): 4-6.
